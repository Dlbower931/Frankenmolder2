services:
  ros:
    container_name: frankenmolder_ros
    
    # --- CRITICAL FIX: Ensure 'build' has exactly 2 spaces of indentation ---
    build:
      # Ensure 'context' and 'dockerfile' have exactly 4 spaces
      context: .
      dockerfile: Dockerfile
    
    privileged: true
    restart: always 
    
    # Environment variables for ROS networking
    environment:
      - ROS_MASTER_URI=http://localhost:11311
      - ROS_IP=100.119.150.8
      
    ports:
      - "11311:11311" # ROS Master
      # --- CRITICAL FIX: Add Foxglove WebSocket port (8080) ---
      - "8080:8080"
      
    devices:
      - /dev/spidev0.0:/dev/spidev0.0
      
    # Make sure this volumes block is also indented correctly (2 spaces)
    volumes:
      - ./pi_ros_logs:/data/ros_logs 
      
    # Make sure this command block is indented correctly (2 spaces)
    command: /bin/bash -c "source /opt/ros/noetic/setup.bash && /app/start_node.sh; sleep infinity"