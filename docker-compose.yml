version: '3.7'

services:
  ros:
    container_name: frankenmolder_ros
    build:
      context: .
      dockerfile: Dockerfile
    
    # --- CRITICAL FIX: Use Host Network Mode ---
    network_mode: host 
    
    privileged: true
    restart: always 
    
    # ENVIRONMENT VARIABLES CAN NOW BE SIMPLER
    environment:
      # Pass the host's display environment variable into the container
      - DISPLAY=${DISPLAY} 

      # ... (existing ROS_MASTER_URI and ROS_IP settings)
      - ROS_MASTER_URI=http://100.119.150.8:11311
      - ROS_IP=100.119.150.8
      
    volumes:
      # Mount the X11 Unix socket into the container to enable GUI access
      - /tmp/.X11-unix:/tmp/.X11-unix:rw 
      # ... (existing pi_ros_logs volume)
      - ./pi_ros_logs:/data/ros_logs 
      
    command: /bin/bash -c "source /opt/ros/noetic/setup.bash && /app/start_node.sh; sleep infinity"