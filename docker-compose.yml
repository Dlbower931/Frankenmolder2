version: '3.7'

services:
  ros:
    container_name: frankenmolder_ros
    build:
      context: .
      dockerfile: Dockerfile
    
    # --- Networking: Use the host's network stack ---
    network_mode: host 
    
    # --- Permissions & Security: Keep essential hardware access ---
    privileged: true 
    # Remove tty, stdin_open, security_opt, and user lines

    restart: always 
    
    # --- Environment Variables ---
    environment:
      # Keep these two set to your PI_TAILSCALE_IP
      - ROS_MASTER_URI=http://100.119.150.8:11311
      - ROS_IP=100.119.150.8
      # Remove DISPLAY, XAUTHORITY, USER, UID, GID lines
      
    # --- Volume Mounts: Keep only logs ---
    volumes:
      # Remove X11 and XAUTHORITY mounts
      - ./pi_ros_logs:/data/ros_logs 
      
    # SPI Device Access
    devices:
      - /dev/spidev0.0:/dev/spidev0.0
      
    # The command runs your startup script
    command: /bin/bash -c "source /opt/ros/noetic/setup.bash && /app/start_node.sh; sleep infinity"